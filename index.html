<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Ponto e Banco de Horas</title>
    <style>
        /* CSS */
        :root {
            --primary-color: #4a90e2; --secondary-color: #f4f7f6; --text-color: #333;
            --border-color: #ddd; --success-color: #28a745; --danger-color: #dc3545;
            --neutral-color: #6c757d; --export-color: #6f42c1;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--secondary-color); color: var(--text-color); margin: 0; padding: 20px; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; }
        .container { width: 100%; max-width: 800px; background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        h1, h2 { text-align: center; }
        h1 { color: var(--primary-color); margin-bottom: 10px; }
        h2 { margin-top: 0; font-weight: 500; }
        .info-panels { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .saldo-banco, .resumo-semana { padding: 15px; border-radius: 6px; background-color: #e9ecef; }
        #saldoTotal, #horasNaSemana { font-size: 2em; font-weight: bold; }
        #metaSemanal { font-size: 1em; color: var(--neutral-color); }
        #saldoTotal.positivo { color: var(--success-color); }
        #saldoTotal.negativo { color: var(--danger-color); }
        #saldoTotal.zerado { color: var(--neutral-color); }
        #horasNaSemana { color: var(--primary-color); }
        form { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-bottom: 30px; align-items: end; }
        .form-group { display: flex; flex-direction: column; }
        label { margin-bottom: 5px; font-weight: 500; font-size: 0.9em; }
        input[type="date"], input[type="time"] { padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 1em; }
        .actions, .report-actions { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 20px; grid-column: 1 / -1; justify-content: center; }
        button { padding: 12px 20px; border: none; border-radius: 4px; font-size: 1em; font-weight: bold; cursor: pointer; transition: background-color 0.2s, transform 0.1s; }
        button:active { transform: scale(0.98); }
        button.primary { background-color: var(--primary-color); color: white; }
        button.primary:hover { background-color: #357abd; }
        button.secondary { background-color: var(--success-color); color: white; }
        button.secondary:hover { background-color: #218838; }
        button.export { background-color: var(--export-color); color: white; }
        button.export:hover { background-color: #5a2d9e; }
        button.danger { background-color: var(--danger-color); color: white; }
        button.danger:hover { background-color: #c82333; }
        #relatorioContainer { margin-top: 30px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
        th, td { border: 1px solid var(--border-color); padding: 10px; text-align: center; }
        th { background-color: var(--secondary-color); font-weight: 600; }
        td.positivo strong { color: var(--success-color); }
        td.negativo strong { color: var(--danger-color); }
        
        /* NOVO CÓDIGO CSS PARA O FEEDBACK VISUAL */
        @keyframes flash {
            0% { background-color: #fff; }
            50% { background-color: #e2f1ff; }
            100% { background-color: #fff; }
        }
        .flash-animation {
            animation: flash 1s ease-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Controle de Ponto</h1>
        <div class="info-panels">
            <div class="saldo-banco">
                <h2>Saldo do Banco de Horas</h2>
                <span id="saldoTotal" class="zerado">00:00</span>
            </div>
            <div class="resumo-semana">
                <h2>Horas na Semana</h2>
                <span id="horasNaSemana">00:00</span>
                <span id="metaSemanal">/ 44:00</span>
            </div>
        </div>
        <form id="pontoForm">
            <div class="form-group"> <label for="data">Data</label> <input type="date" id="data" required> </div>
            <div class="form-group"> <label for="inicio">Início Expediente (07:00)</label> <input type="time" id="inicio" required value="07:00"> </div>
            <div class="form-group"> <label for="saidaIntervalo">Saída Intervalo</label> <input type="time" id="saidaIntervalo" required> </div>
            <div class="form-group"> <label for="voltaIntervalo">Volta Intervalo</label> <input type="time" id="voltaIntervalo" required> </div>
            <div class="form-group"> <label for="fim">Fim Expediente (17:00)</label> <input type="time" id="fim" required value="17:00"> </div>
            <div class="actions"> <button type="submit" class="primary">Registrar Ponto</button> </div>
        </form>
        <hr>
        <div class="report-actions">
            <button onclick="gerarRelatorio()" class="secondary">Gerar Relatório na Tela</button>
            <button onclick="exportarDados('csv')" class="export">Exportar para CSV</button>
            <button onclick="exportarDados('json')" class="export">Exportar para JSON</button>
            <button onclick="limparDados()" class="danger">Limpar Todos os Dados</button>
        </div>
        <div id="relatorioContainer"></div>
    </div>

    <script>
        // JAVASCRIPT
        const JORNADA_CONTRATUAL_MINUTOS = (7 * 60) + 20;
        const META_SEMANAL_MINUTOS = 44 * 60;
        const STORAGE_KEY = 'registrosDePonto';
        const pontoForm = document.getElementById('pontoForm');
        const dataInput = document.getElementById('data');
        const saldoTotalEl = document.getElementById('saldoTotal');
        const horasNaSemanaEl = document.getElementById('horasNaSemana');
        const relatorioContainer = document.getElementById('relatorioContainer');

        function timeStringToMinutes(t) { const [h,m]=t.split(':').map(Number); return h*60+m; }
        function minutesToTimeString(m) { if(isNaN(m)) return "00:00"; const s=m<0?"-":""; const a=Math.abs(m); const h=Math.floor(a/60); const n=Math.round(a%60); return `${s}${String(h).padStart(2,'0')}:${String(n).padStart(2,'0')}`; }
        function formatarData(d) { const [a,m,i]=d.split('-'); return `${i}/${m}/${a}`; }
        function getInicioDaSemana(d) { const t=new Date(d); const a=t.getDay(); const e=t.getDate()-a+(a===0?-6:1); const r=new Date(t.setDate(e)); r.setHours(0,0,0,0); return r; }
        function getRegistros() { const t=localStorage.getItem(STORAGE_KEY); return t?JSON.parse(t):[]; }
        function saveRegistros(r) { r.sort((t,a)=>new Date(t.data+'T00:00:00')-new Date(a.data+'T00:00:00')); localStorage.setItem(STORAGE_KEY,JSON.stringify(r)); }
        function atualizarHorasSemanais() { const t=getInicioDaSemana(new Date()); const a=getRegistros(); const e=a.filter(a=>new Date(a.data+'T00:00:00')>=t); const r=e.reduce((t,a)=>t+a.totalMinutosTrabalhados,0); horasNaSemanaEl.textContent=minutesToTimeString(r); }
        function atualizarSaldoTotal() { const t=getRegistros(); const a=t.reduce((t,a)=>t+a.saldoDiaMinutos,0); saldoTotalEl.textContent=minutesToTimeString(a); saldoTotalEl.className=''; if(a>0)saldoTotalEl.classList.add('positivo'); else if(a<0)saldoTotalEl.classList.add('negativo'); else saldoTotalEl.classList.add('zerado'); }
        function registrarPonto(t) { t.preventDefault(); const a=document.getElementById('data').value, e=document.getElementById('inicio').value, r=document.getElementById('saidaIntervalo').value, o=document.getElementById('voltaIntervalo').value, n=document.getElementById('fim').value; const s=getRegistros(); if(s.some(t=>t.data===a)){alert('Já existe um registro para esta data.');return;} const l=timeStringToMinutes(e), i=timeStringToMinutes(r), d=timeStringToMinutes(o), c=timeStringToMinutes(n); if(c<=l||d<=i){alert("Os horários parecem estar incorretos.");return;} const u=i-l+c-d; const g=u-JORNADA_CONTRATUAL_MINUTOS; const m={data:a,inicio:e,saidaIntervalo:r,voltaIntervalo:o,fim:n,totalTrabalhado:minutesToTimeString(u),saldoDia:minutesToTimeString(g),totalMinutosTrabalhados:u,saldoDiaMinutos:g}; s.push(m); saveRegistros(s); alert('Ponto registrado com sucesso!'); pontoForm.reset(); dataInput.valueAsDate=new Date(); atualizarSaldoTotal(); atualizarHorasSemanais(); gerarRelatorio(); }
        
        /**
         * ALTERAÇÃO AQUI: Função `gerarRelatorio` com feedback visual.
         */
        function gerarRelatorio() {
            const registros = getRegistros();
            if (registros.length === 0) { relatorioContainer.innerHTML = "<p>Nenhum registro encontrado para exibir na tela.</p>"; return; }
            let tableHTML = `<h2>Relatório de Entradas e Saídas</h2><table><thead><tr><th>Data</th><th>Início</th><th>Saída Int.</th><th>Volta Int.</th><th>Fim</th><th>Total Trabalhado</th><th>Saldo do Dia</th></tr></thead><tbody>`;
            registros.forEach(r => { const saldoClasse = r.saldoDiaMinutos > 0 ? 'positivo' : r.saldoDiaMinutos < 0 ? 'negativo' : 'zerado'; tableHTML += `<tr><td>${formatarData(r.data)}</td><td>${r.inicio}</td><td>${r.saidaIntervalo}</td><td>${r.voltaIntervalo}</td><td>${r.fim}</td><td>${r.totalTrabalhado}</td><td class="${saldoClasse}"><strong>${r.saldoDia}</strong></td></tr>`; });
            tableHTML += '</tbody></table>';
            relatorioContainer.innerHTML = tableHTML;

            // Adiciona o efeito de "flash" para mostrar que a ação ocorreu
            relatorioContainer.classList.add('flash-animation');
            // Remove a classe da animação após 1 segundo para que possa ser usada de novo
            setTimeout(() => {
                relatorioContainer.classList.remove('flash-animation');
            }, 1000);
        }

        function exportarDados(formato) { const r=getRegistros(); if(r.length===0){alert('Não há dados para exportar.');return;} let t,a,e; const o=new Date().toISOString().slice(0,10); if(formato==='csv'){const n=['Data','Inicio','Saida_Intervalo','Volta_Intervalo','Fim','Total_Trabalhado_HHMM','Saldo_Dia_HHMM']; const s=r.map(t=>[formatarData(t.data),t.inicio,t.saidaIntervalo,t.voltaIntervalo,t.fim,t.totalTrabalhado,t.saldoDia].join(',')); t=[n.join(','),...s].join('\n'); a='text/csv;charset=utf-8;'; e=`relatorio_ponto_${o}.csv`;}else if(formato==='json'){t=JSON.stringify(r,null,2); a='application/json;charset=utf-8;'; e=`backup_ponto_${o}.json`;} triggerDownload(t,e,a); }
        function triggerDownload(t,a,e){ const r=new Blob([t],{type:e}); const o=URL.createObjectURL(r); const n=document.createElement('a'); n.style.display='none'; n.href=o; n.download=a; document.body.appendChild(n); n.click(); URL.revokeObjectURL(o); document.body.removeChild(n); }
        function limparDados() { if(confirm('Tem certeza que deseja apagar TODOS os registros? Esta ação não pode ser desfeita.')){localStorage.removeItem(STORAGE_KEY); atualizarSaldoTotal(); atualizarHorasSemanais(); gerarRelatorio(); alert('Todos os dados foram apagados.');}}
        
        pontoForm.addEventListener('submit', registrarPonto);
        document.addEventListener('DOMContentLoaded', () => { dataInput.valueAsDate=new Date(); atualizarSaldoTotal(); atualizarHorasSemanais(); gerarRelatorio(); });
    </script>
</body>
</html>